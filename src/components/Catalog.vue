<script setup>
import { ref, computed } from "vue";

const items = ref([
  {
    id: 1,
    title: '–ê–≥–∞–≤–∞ "–ê–º–∏–≥–æ –î–∂–∞–º–±–æ"',
    description:
      '–ê–≥–∞–≤–∞ "–ê–º–∏–≥–æ –î–∂–∞–º–±–æ" ‚Äî —ç—Ç–æ –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ, –æ—Ç–ª–∏—á–∞—é—â–µ–µ—Å—è –∫—Ä—É–ø–Ω—ã–º–∏, –º—è—Å–∏—Å—Ç—ã–º–∏ –ª–∏—Å—Ç—å—è–º–∏ —Å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω–æ–π –≥–æ–ª—É–±–æ–≤–∞—Ç–æ-–∑–µ–ª–µ–Ω–æ–π –æ–∫—Ä–∞—Å–∫–æ–π. –û–Ω –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —è—Ä–∫–∏—Ö –∞–∫—Ü–µ–Ω—Ç–æ–≤ –≤ –∏–Ω—Ç–µ—Ä—å–µ—Ä–µ –±–ª–∞–≥–æ–¥–∞—Ä—è —Å–≤–æ–µ–º—É —ç—Ñ—Ñ–µ–∫—Ç–Ω–æ–º—É –≤–Ω–µ—à–Ω–µ–º—É –≤–∏–¥—É.',
    price: 800,
    image:
      "https://planetaflora.ru/images/virtuemart/product/flori/agava-amigo-dzhambo16.jpg",
    care: "–Ω–µ–ø—Ä–∏—Ö–æ—Ç–ª–∏–≤—ã–µ",
  },
  {
    id: 2,
    title: '–ì–∞—Å—Ç–µ—Ä–∏—è "Amour" ',
    description:
      '–ì–∞—Å—Ç–µ—Ä–∏—è "Amour" ‚Äî —ç—Ç–æ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–µ —Å—É–∫–∫—É–ª–µ–Ω—Ç–Ω–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ —Å –ø–ª–æ—Ç–Ω—ã–º–∏ —Ç–µ–º–Ω–æ-–∑–µ–ª–µ–Ω—ã–º–∏ –ª–∏—Å—Ç—å—è–º–∏, –ø–æ–∫—Ä—ã—Ç—ã–º–∏ —Å–≤–µ—Ç–ª—ã–º–∏ –ø—è—Ç–Ω–∞–º–∏. –û–Ω–æ –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –¥–µ–∫–æ—Ä–∞ –∏–Ω—Ç–µ—Ä—å–µ—Ä–∞, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ –∫–æ–º–Ω–∞—Ç–∞—Ö —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º –æ—Å–≤–µ—â–µ–Ω–∏–µ–º, —Ç–∞–∫ –∫–∞–∫ –ª–µ–≥–∫–æ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ —É—Å–ª–æ–≤–∏—è–º –ø–æ–ª—É—Ç–µ–Ω–∏ –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —á–∞—Å—Ç–æ–≥–æ –ø–æ–ª–∏–≤–∞.',
    price: 450,
    image:
      "https://planetaflora.ru/images/virtuemart/product/flori/gasteriya-amour2733.jpg",
    care: "–Ω–µ–ø—Ä–∏—Ö–æ—Ç–ª–∏–≤—ã–µ",
  },
  {
    id: 3,
    title: '–ú–µ–ª–æ–∫–∞–∫—Ç—É—Å "Matanzanus"',
    description:
      '–ú–µ–ª–æ–∫–∞–∫—Ç—É—Å "Matanzanus" ‚Äî –Ω–µ–æ–±—ã—á–Ω—ã–π –∫–∞–∫—Ç—É—Å —Å –æ–∫—Ä—É–≥–ª—ã–º —Ç–µ–ª–æ–º –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã–º ¬´—Ç—É—Ä–±–∞–Ω–æ–º¬ª –∏–∑ –≥—É—Å—Ç—ã—Ö —â–µ—Ç–∏–Ω–æ–∫ –Ω–∞ –≤–µ—Ä—à–∏–Ω–µ. –≠—Ç–æ —Ç–µ–ø–ª–æ–ª—é–±–∏–≤–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç —è—Ä–∫–∏–π —Å–≤–µ—Ç –∏ —Å—Ç–∞–Ω–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–Ω—ã–º –∞–∫—Ü–µ–Ω—Ç–æ–º –≤ –ª—é–±–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Å—É–∫–∫—É–ª–µ–Ω—Ç–æ–≤.',
    price: 1200,
    image:
      "https://planetaflora.ru/images/virtuemart/product/flori/melokaktus-matanzanus8010.jpg",
    care: "—Å—Ä–µ–¥–Ω–∏–π —É—Ö–æ–¥",
  },
  {
    id: 4,
    title: '–ö–∞–ª–∞—Ç–µ—è "Beautystar"',
    description:
      '–ö–∞–ª–∞—Ç–µ—è "Beautystar" ‚Äî –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ —Å –ø—Ä–æ–¥–æ–ª–≥–æ–≤–∞—Ç—ã–º–∏ –ª–∏—Å—Ç—å—è–º–∏, —É–∫—Ä–∞—à–µ–Ω–Ω—ã–º–∏ —Å–≤–µ—Ç–ª—ã–º–∏ –ø–æ–ª–æ—Å–∞–º–∏ –Ω–∞ —Ç—ë–º–Ω–æ-–∑–µ–ª—ë–Ω–æ–º —Ñ–æ–Ω–µ. –ï—ë –∏–∑—è—â–Ω—ã–π —Ä–∏—Å—É–Ω–æ–∫ –∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–∫–ª–∞–¥—ã–≤–∞—Ç—å –ª–∏—Å—Ç—å—è –Ω–∞ –Ω–æ—á—å –ø—Ä–∏–¥–∞—é—Ç –∏–Ω—Ç–µ—Ä—å–µ—Ä—É –∂–∏–≤–æ—Å—Ç—å –∏ –¥–∏–Ω–∞–º–∏–∫—É.',
    price: 1500,
    image:
      "https://planetaflora.ru/images/virtuemart/product/flori/kalateya-beautystar8394.jpg",
    care: "–ø—Ä–∏—Ö–æ—Ç–ª–∏–≤—ã–µ",
  },
  {
    id: 5,
    title: '–ü–∞—Å–ª–µ–Ω –∫–∏—Ç–æ—Å–∫–∏–π "Jurassica"',
    description:
      '–ü–∞—Å–ª—ë–Ω –∫–∏—Ç–æ—Å–∫–∏–π "Jurassica" ‚Äî —ç–∫–∑–æ—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ —Å —Ä–µ–∑–Ω—ã–º–∏ —Ñ–∏–æ–ª–µ—Ç–æ–≤–æ-–∑–µ–ª—ë–Ω—ã–º–∏ –ª–∏—Å—Ç—å—è–º–∏, –Ω–∞–ø–æ–º–∏–Ω–∞—é—â–∏–º–∏ –¥–æ–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –ø–∞–ø–æ—Ä–æ—Ç–Ω–∏–∫–∏. –ï–≥–æ –Ω–µ–æ–±—ã—á–Ω–∞—è —Ñ–æ—Ä–º–∞ –∏ –æ–∫—Ä–∞—Å–∫–∞ –¥–µ–ª–∞—é—Ç –µ–≥–æ —è—Ä–∫–∏–º –∞–∫—Ü–µ–Ω—Ç–æ–º –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö —Ä–∞—Å—Ç–µ–Ω–∏–π.',
    price: 1000,
    image:
      "https://planetaflora.ru/images/virtuemart/product/flori/paslen-kitoskiy-jurassica11566.jpg",
    care: "—Å—Ä–µ–¥–Ω–∏–π —É—Ö–æ–¥",
  },
  {
    id: 6,
    title: '–ü–µ–ø–µ—Ä–æ–º–∏—è "Jayde"',
    description:
      '–ü–µ–ø–µ—Ä–æ–º–∏—è "Jayde" ‚Äî –∫–æ–º–ø–∞–∫—Ç–Ω–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ —Å –º—è—Å–∏—Å—Ç—ã–º–∏, –≥–ª—è–Ω—Ü–µ–≤—ã–º–∏ –ª–∏—Å—Ç—å—è–º–∏ –Ω–∞—Å—ã—â–µ–Ω–Ω–æ–≥–æ –∑–µ–ª—ë–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞. –û—Ç–ª–∏—á–∞–µ—Ç—Å—è –Ω–µ–ø—Ä–∏—Ö–æ—Ç–ª–∏–≤–æ—Å—Ç—å—é –∏ –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –æ–∑–µ–ª–µ–Ω–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—å–µ—Ä–æ–≤.',
    price: 950,
    image:
      "https://planetaflora.ru/images/virtuemart/product/flori/peperomiya-jayde11991.jpg",
    care: "–Ω–µ–ø—Ä–∏—Ö–æ—Ç–ª–∏–≤—ã–µ",
  },
  {
    id: 7,
    title: '–ö—Ä–∏–ø—Ç–∞–Ω—Ç—É—Å "Pink Starlight"',
    description:
      '–ö—Ä–∏–ø—Ç–∞–Ω—Ç—É—Å –¥–≤—É–ø–æ–ª–æ—Å–∞—Ç—ã–π "Pink Starlight" ‚Äî —ç—Ñ—Ñ–µ–∫—Ç–Ω–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ —Å —Ä–æ–∑–æ–≤—ã–º–∏ –ª–∏—Å—Ç—å—è–º–∏ –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã–º–∏ –±–µ–ª—ã–º–∏ –ø–æ–ª–æ—Å–∞–º–∏. –ï–≥–æ –∑–≤–µ–∑–¥–æ–æ–±—Ä–∞–∑–Ω–∞—è —Ä–æ–∑–µ—Ç–∫–∞ –ø—Ä–∏–¥–∞—ë—Ç —ç–∫–∑–æ—Ç–∏—á–µ—Å–∫–∏–π –∞–∫—Ü–µ–Ω—Ç –ª—é–±–æ–º—É –∏–Ω—Ç–µ—Ä—å–µ—Ä—É.',
    price: 850,
    image:
      "https://planetaflora.ru/images/virtuemart/product/flori/kriptantus-dvupolosatyy-pink-starlight8978.jpg",
    care: "—Å—Ä–µ–¥–Ω–∏–π —É—Ö–æ–¥",
  },
  {
    id: 8,
    title: '–ü–∞–Ω–¥–∞–Ω—É—Å –í–µ–π—á–∞ "X"',
    description:
      '–ü–∞–Ω–¥–∞–Ω—É—Å –í–µ–π—á–∞ "X" ‚Äî –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ —Å –∂—ë—Å—Ç–∫–∏–º–∏ –∑–µ–ª—ë–Ω—ã–º–∏ –ª–∏—Å—Ç—å—è–º–∏, —É–∫—Ä–∞—à–µ–Ω–Ω—ã–º–∏ —Å–≤–µ—Ç–ª—ã–º–∏ –ø—Ä–æ–¥–æ–ª—å–Ω—ã–º–∏ –ø–æ–ª–æ—Å–∞–º–∏. –ë–ª–∞–≥–æ–¥–∞—Ä—è —Å–≤–æ–µ–º—É —ç–∫–∑–æ—Ç–∏—á–µ—Å–∫–æ–º—É –æ–±–ª–∏–∫—É –∏ —Å–ø–∏—Ä–∞–ª—å–Ω–æ–º—É —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—é –ª–∏—Å—Ç—å–µ–≤, –æ–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω—ã–º –∞–∫—Ü–µ–Ω—Ç–æ–º –≤ –ø–æ–º–µ—â–µ–Ω–∏–∏.',
    price: 2000,
    image:
      "https://planetaflora.ru/images/virtuemart/product/flori/pandanus-veycha-x11564.jpg",
    care: "–ø—Ä–∏—Ö–æ—Ç–ª–∏–≤—ã–µ",
  },
  {
    id: 9,
    title: "–°–ø–∞—Ç–∏—Ñ–∏–ª–ª—É–º",
    description:
      '–ü–ª–µ–∫—Ç—Ä–∞–Ω—Ç—É—Å "Caninus Sumcol 01" ‚Äî –∫–æ–º–ø–∞–∫—Ç–Ω–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ —Å –º–µ–ª–∫–∏–º–∏ –∑–µ–ª—ë–Ω—ã–º–∏ –ª–∏—Å—Ç—å—è–º–∏, –∏—Å—Ç–æ—á–∞—é—â–∏–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã–π –∞—Ä–æ–º–∞—Ç. –ò–∑–≤–µ—Å—Ç–µ–Ω –∫–∞–∫ "–∞–Ω—Ç–∏–∫–æ—à–∞—á–∏–π" —Ü–≤–µ—Ç–æ–∫, —Ç–∞–∫ –∫–∞–∫ –µ–≥–æ –∑–∞–ø–∞—Ö –æ—Ç–ø—É–≥–∏–≤–∞–µ—Ç –∂–∏–≤–æ—Ç–Ω—ã—Ö.',
    price: 1200,
    image:
      "https://planetaflora.ru/images/virtuemart/product/flori/plektrantus-caninus-sumcol-0112750.jpg",
    care: "–ø—Ä–∏—Ö–æ—Ç–ª–∏–≤—ã–µ",
  },
]);
const careFilter = ref("");
const selectedItem = ref(null);
const isFavorite = ref({});

const isInCart = ref({}); 
const showWarning = ref(false);

const currentUser = JSON.parse(localStorage.getItem("currentUser"));
const isLoggedIn = currentUser !== null;

const filteredItems = computed(() => {
  if (!careFilter.value) return items.value;
  return items.value.filter((item) => item.care === careFilter.value);
});

function openModal(item) {
  selectedItem.value = item;
  showWarning.value = false;
}

function closeModal() {
  selectedItem.value = null;
}
function addToCart() {
  if (!selectedItem.value) return;
  const itemId = selectedItem.value.id;
  const existingCart = JSON.parse(localStorage.getItem("cartItems")) || [];

  if (isInCart.value[itemId]) {
    delete isInCart.value[itemId];
    const updatedCart = existingCart.filter((item) => item.id !== itemId);
    localStorage.setItem("cartItems", JSON.stringify(updatedCart));
  } else {
 
    isInCart.value[itemId] = true;
    existingCart.push(selectedItem.value);
    localStorage.setItem("cartItems", JSON.stringify(existingCart));
  }
}

function handleFavorite() {
  if (!isLoggedIn) {
    showWarning.value = true;
    return;
  }

  const itemId = selectedItem.value.id;
  isFavorite.value[itemId] = !isFavorite.value[itemId];

  const favorites = JSON.parse(localStorage.getItem("favorites")) || {};

  if (isFavorite.value[itemId]) {
    favorites[itemId] = true;
  } else {
    delete favorites[itemId];
  }

  localStorage.setItem("favorites", JSON.stringify(favorites));
}

const favoritesFromStorage =
  JSON.parse(localStorage.getItem("favorites")) || {};
isFavorite.value = { ...favoritesFromStorage };
</script>

<template>
  <div class="bg">
    <div class="filters">
      <label for="care">–£—Ö–æ–¥ –∑–∞ —Ä–∞—Å—Ç–µ–Ω–∏–µ–º:</label>
      <select id="care" v-model="careFilter" @change="applyFilter">
        <option value="">–í—Å–µ</option>
        <option value="–ø—Ä–∏—Ö–æ—Ç–ª–∏–≤—ã–µ">–ü—Ä–∏—Ö–æ—Ç–ª–∏–≤—ã–µ</option>
        <option value="–Ω–µ–ø—Ä–∏—Ö–æ—Ç–ª–∏–≤—ã–µ">–ù–µ–ø—Ä–∏—Ö–æ—Ç–ª–∏–≤—ã–µ</option>
        <option value="—Å—Ä–µ–¥–Ω–∏–π —É—Ö–æ–¥">–°—Ä–µ–¥–Ω–∏–π —É—Ö–æ–¥</option>
      </select>
    </div>

    <div class="gallery">
      <div
        v-for="item in filteredItems"
        :key="item.id"
        class="item"
        @click="openModal(item)"
      >
        <img :src="item.image" alt="item" />
        <h3>{{ item.title }}</h3>
        <p class="price">{{ item.price }} ‚ÇΩ</p>
      </div>
    </div>

   
    <div v-if="selectedItem" class="modal-overlay" @click.self="closeModal">
      <div class="modal">
        <img :src="selectedItem.image" class="modal-image" />
        <div class="modal-details">
          <h2>{{ selectedItem.title }}</h2>
          <p>{{ selectedItem.description }}</p>
          <p class="price">{{ selectedItem.price }} ‚ÇΩ</p>
          <div class="buttons">
           
            <button
              @click.stop="addToCart"
              :class="{
                added: isInCart[selectedItem.id],
                default: !isInCart[selectedItem.id],
              }"
            >
              {{
                isInCart[selectedItem.id] ? "‚úì –í –∫–æ—Ä–∑–∏–Ω–µ" : "–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É"
              }}
            </button>

           
            <button
              @click.stop="handleFavorite"
              :class="{
                'favorite-active': isFavorite[selectedItem.id],
                favorite: !isFavorite[selectedItem.id],
              }"
            >
              {{
                isFavorite[selectedItem.id]
                  ? "üíö –í –∏–∑–±—Ä–∞–Ω–Ω–æ–º"
                  : "ü§ç –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ"
              }}
            </button>

            <p v-if="!isLoggedIn && showWarning" style="color: red">
              –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç.
            </p>

            <button @click="closeModal">–ó–∞–∫—Ä—ã—Ç—å</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<style scoped>
h2 {
  color: #346f6e;
}
* {
  font-family: "Nunito", sans-serif;
  box-sizing: border-box;
}

.bg {
  min-height: 100vh;
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  background-image: url("../../assets/images/contact.jpg");
  background-size: cover;
  background-repeat: no-repeat;
  background-position: center;
  padding: 40px 20px;
}

.filters {
  display: flex;
  justify-content: center;
  gap: 20px;
  width: 100%;
  max-width: 600px;
  margin-bottom: 30px;
}

.filters label {
  font-size: 16px;
  color: #214443;
  font-weight: bold;
}

.filters select {
  padding: 8px 12px;
  font-size: 16px;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-family: "Nunito", sans-serif;
  width: 200px;
}

.gallery {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 16px;
  width: 100%;
  max-width: 1000px;
  margin: 20px auto;
}

.item {
  aspect-ratio: 1 / 1;
  border: 2px solid #ccc;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  background-color: #f8f8f8;
  border-radius: 8px;
  transition: transform 0.2s;
}

.item:hover {
  transform: scale(1.02);
}

.item img {
  width: 80%;
  height: 80%;
  object-fit: cover;
  border-radius: 6px;
}

.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 10;
}

.modal {
  background: white;
  display: flex;
  gap: 20px;
  padding: 20px;
  border-radius: 12px;
  max-width: 800px;
  width: 90%;
}

.modal-image {
  width: 300px;
  height: 300px;
  object-fit: cover;
  border-radius: 10px;
}

.modal-details {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

.modal-details h2 {
  margin-bottom: 12px;
  font-size: 24px;
  color: #333;
}

.modal-details p {
  margin-bottom: 10px;
  line-height: 1.4;
  color: #555;
}

.price {
  font-size: 20px;
  font-weight: bold;
  color: #2d7a42;
}

.buttons {
  display: flex;
  gap: 10px;
  margin-top: 20px;
}

button {
  padding: 10px 16px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  background-color: #4caf50;
  color: white;
  font-weight: 500;
}

button:last-child {
  background-color: #999;
}
.default {
  background-color: #ddd;
  color: #333;
}

.added {
  background-color: #4caf50; 
  color: white;
}

.favorite {
  background-color: white;
  color: #444;
  border: 2px solid #888;
}

.favorite-active {
  background-color: #4caf50;
  color: white;
  border: 2px solid #4caf50;
}
@media (max-width: 768px) {
  .modal {
    flex-direction: column;
    padding: 16px;
    max-width: 90%;
    width: 100%;
  }

  .modal-image {
    width: 100%;
    height: auto;
    max-height: 300px;
    margin-bottom: 16px;
  }

  .modal-details h2 {
    font-size: 20px;
  }

  .modal-details p {
    font-size: 14px;
  }

  .buttons {
    flex-direction: column;
    gap: 10px;
  }

  button {
    width: 100%;
    font-size: 16px;
  }
}
</style>
